
<!DOCTYPE html>
<html>
<head>
  <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {{ font-family: Arial; margin: 20px; }}
    input, textarea {{ width: 100%; margin-bottom: 10px; }}
    button {{ margin-right: 10px; }}
    .news-item {{ border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }}
  </style>
</head>
<body>
  <h2>üìù ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πà‡∏≤‡∏ß</h2>
  <input type="hidden" id="edit_id">
  <input type="text" id="title" placeholder="‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ç‡πà‡∏≤‡∏ß">
  <textarea id="content" placeholder="‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ç‡πà‡∏≤‡∏ß"></textarea>
  <input type="file" id="image"><br>
  <button onclick="saveNews()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <button onclick="clearForm()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏°</button>
  <p id="status"></p>

  
  <div id="myNewsList">Loading...</div>

  <script>
    const supabase = window.supabase.createClient('https://csrqddcrapehdytwjufk.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzcnFkZGNyYXBlaGR5dHdqdWZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1MzE4MzAsImV4cCI6MjA2NzEwNzgzMH0.Xoxk-LQXFhGmjeDQXZOP-8_JH3fIs7YAOjFnB5aPp7c');
    let currentUserId = null;

    async function init() {{
      const {{ data: userData }} = await supabase.auth.getUser();
      if (!userData || !userData.user) {{
        document.body.innerHTML = "<p>‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤ login ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>";
        return;
      }}
      currentUserId = userData.user.id;
      
    const userCheck = await supabase.auth.getUser();
    if (!userCheck?.data?.user) {
      document.body.innerHTML = "<p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πà‡∏≤‡∏ß</p>";
      return;
    }

    loadMyNews();
 {{
      const {{ data, error }} = await supabase.from('news').select('*').eq('created_by', currentUserId).order('created_at', {{ ascending: false }});
      const list = document.getElementById('myNewsList');
      if (error || !data.length) return list.innerHTML = "<p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>";
      list.innerHTML = '';
      data.forEach(n => list.innerHTML += `
        <div class="news-item">
          <h4>${{n.title}}</h4>
          <p>${{n.content}}</p>
          ${{n.image_url ? `<img src="${{n.image_url}}" width=200><br>` : ''}}
          <button onclick='editNews(${JSON.stringify(n)})'>‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
          <button onclick='deleteNews("${n.id}")'>üóëÔ∏è ‡∏•‡∏ö</button>
        </div>
      `);
    }}

    init();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = supabase.createClient('https://csrqddcrapehdytwjufk.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzcnFkZGNyYXBlaGR5dHdqdWZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1MzE4MzAsImV4cCI6MjA2NzEwNzgzMH0.Xoxk-LQXFhGmjeDQXZOP-8_JH3fIs7YAOjFnB5aPp7c');

    supabase.auth.getUser().then(({ data: { user } }) => {
      if (!user) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
        window.location.href = "auth.html";
      }
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabase = supabase.createClient('https://csrqddcrapehdytwjufk.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNzcnFkZGNyYXBlaGR5dHdqdWZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1MzE4MzAsImV4cCI6MjA2NzEwNzgzMH0.Xoxk-LQXFhGmjeDQXZOP-8_JH3fIs7YAOjFnB5aPp7c');

    document.body.style.display = "none"; // ‡∏ã‡πà‡∏≠‡∏ô‡∏ó‡∏∏‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô

    async function checkLoginStrict() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session || !session.user) {
        alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ");
        window.location.href = "auth.html";
      } else {
        document.body.style.display = "block"; // ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠ login ‡πÅ‡∏•‡πâ‡∏ß
      }
    }

    checkLoginStrict();
  </script>
</body>
</html>
